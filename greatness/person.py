# app.py
# ê³ ë“±í•™ìƒìš© â€˜ëŒ€í†µë ¹ ì„±í–¥ í…ŒìŠ¤íŠ¸â€™ Streamlit ì›¹ì•±
import streamlit as st

st.set_page_config(page_title="ëŒ€í†µë ¹ ì„±í–¥ í…ŒìŠ¤íŠ¸", page_icon="ğŸ—³ï¸", layout="centered")

# =============================
# 0. ê¾¸ë¯¸ê¸°ìš© ê¸°ë³¸ ì´ë¯¸ì§€ URL
# =============================
VOTE_ICON = "https://cdn-icons-png.flaticon.com/512/1042/1042391.png"  # íˆ¬í‘œ ìƒì ì•„ì´ì½˜
CAND_ICON = {
    "ì´ì¬ëª…": "https://cdn-icons-png.flaticon.com/512/4140/4140047.png",  # ì‚¬ëŒ ì•„ì´ì½˜ ì˜ˆì‹œ
    "ê¹€ë¬¸ìˆ˜": "https://cdn-icons-png.flaticon.com/512/4140/4140048.png",
    "ì´ì¤€ì„": "https://cdn-icons-png.flaticon.com/512/4140/4140051.png",
}

# -----------------------------
# 1. ì§ˆë¬¸Â·ê²°ê³¼ ë°ì´í„°
# -----------------------------
QUESTIONS = [
    {
        "q": "ëª¨ë“  êµ­ë¯¼ì—ê²Œ ë§¤ë‹¬ ì¼ì • ê¸ˆì•¡ì„ ì£¼ëŠ” â€˜ê¸°ë³¸ì†Œë“â€™ì´ ìƒê¸´ë‹¤ë©´ ì–´ë•Œ?",
        "opts": [
            ("ë„ˆë¬´ ì¢‹ì§€! ê¸°íšŒê°€ ìƒê¸°ì–ì•„.", "ì´ì¬ëª…"),
            ("ë‚˜ë¼ê°€ ë‹¤ ì±™ê²¨ì£¼ëŠ” ê±´ ë¬´ë¦¬ì•¼.", "ê¹€ë¬¸ìˆ˜"),
            ("ì²­ë…„ ì°½ì—…Â·ëŒ€ì¶œ ì§€ì›ì´ ë” í˜„ì‹¤ì !", "ì´ì¤€ì„"),
        ],
    },
    {
        "q": "ì§‘ê°’Â·ì›”ì„¸ê°€ ë„ˆë¬´ ë¹„ì‹¸â€¦ í•´ê²° ë°©ë²•ì€ ë­ê°€ ì¢‹ì„ê¹Œ?",
        "opts": [
            ("ê³µê³µì„ëŒ€ì£¼íƒì„ ì™•ì°½ ì§€ì–´ì•¼ í•´.", "ì´ì¬ëª…"),
            ("ê·œì œ í’€ì–´ì„œ ì‹œì¥ì´ ì•Œì•„ì„œ í•´ê²°!", "ê¹€ë¬¸ìˆ˜"),
            ("ì²­ë…„ ê¸°ìˆ™ì‚¬Â·ì›”ì„¸ ì§€ì›ì´ í˜„ì‹¤ì .", "ì´ì¤€ì„"),
        ],
    },
    {
        "q": "ì˜ì‚¬ íŒŒì—… ë“± ì˜ë£Œ ë¬¸ì œ, ì–´ì°Œ í•´ê²°í• ê¹Œ?",
        "opts": [
            ("ê³µê³µì˜ë£Œ ëŠ˜ë¦¬ê³  ì¶©ë¶„íˆ ë…¼ì˜!", "ì´ì¬ëª…"),
            ("ë¹¨ë¦¬ ë³µê·€ì‹œì¼œì„œ ì •ìƒí™”ë¶€í„°!", "ê¹€ë¬¸ìˆ˜"),
            ("ë³´ê±´ë¶€ ë”°ë¡œ ë§Œë“¤ì–´ íš¨ìœ¨ì ìœ¼ë¡œ!", "ì´ì¤€ì„"),
        ],
    },
    {
        "q": "ì •ì¹˜ì¸ë“¤ ì‹¸ìš°ëŠ” ê±° ë³´ë©´ ë‹µë‹µí•´â€¦ ì–´ë–»ê²Œ ë°”ë€Œë©´ ì¢‹ê² ì–´?",
        "opts": [
            ("ê²€Â·ì˜ ê¶Œë ¥ë„ íˆ¬ëª…í•˜ê²Œ ë°”ê¿”ì•¼!", "ì´ì¬ëª…"),
            ("ë‚˜ë¼ ì–´ì§€ëŸ½íˆëŠ” ì„¸ë ¥ë¶€í„° ì •ë¦¬!", "ê¹€ë¬¸ìˆ˜"),
            ("êµ­íšŒ êµ¬ì¡° ìì²´ë¥¼ ëœ¯ì–´ê³ ì¹˜ì!", "ì´ì¤€ì„"),
        ],
    },
    {
        "q": "ì™¸êµÂ·ì•ˆë³´ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ê±´?",
        "opts": [
            ("ëŒ€í™”ì™€ ê· í˜• ì™¸êµê°€ ì¢‹ì•„.", "ì´ì¬ëª…"),
            ("ê°•í•œ êµ°ëŒ€ê°€ ë‚˜ë¼ë¥¼ ì§€í‚¨ë‹¤!", "ê¹€ë¬¸ìˆ˜"),
            ("ìƒí™© ë”°ë¼ ì‹¤ìš©ì ìœ¼ë¡œ ê°€ì•¼ì§€.", "ì´ì¤€ì„"),
        ],
    },
    {
        "q": "ê²½ì œ ì‚´ë¦¬ë ¤ë©´ ë­ê°€ ìµœìš°ì„ ?",
        "opts": [
            ("ë³µì§€ë¥¼ ëŠ˜ë ¤ ê¸°íšŒë¥¼ ë³´ì¥!", "ì´ì¬ëª…"),
            ("ê¸°ì—…ì´ í™œë°œí•´ì•¼ ì¼ìë¦¬ë„!", "ê¹€ë¬¸ìˆ˜"),
            ("ì²­ë…„ ì°½ì—…ì´ ììœ ë¡œì›Œì•¼!", "ì´ì¤€ì„"),
        ],
    },
    {
        "q": "ê°™ì´ ì¼í•  ì •ì¹˜ì¸ì„ ë½‘ëŠ”ë‹¤ë©´?",
        "opts": [
            ("ì‚¬ëŒ ì‚¬ëŠ” ì„¸ìƒ ë§Œë“¤ ì‚¬ëŒ", "ì´ì¬ëª…"),
            ("ë‚˜ë¼ ê·¼ê°„ì„ ë°”ë¡œ ì„¸ìš¸ ì‚¬ëŒ", "ê¹€ë¬¸ìˆ˜"),
            ("ê³µì •ì„ ì¤‘ì‹œí•˜ëŠ” ì Šì€ ë¦¬ë”", "ì´ì¤€ì„"),
        ],
    },
]

RESULTS = {
    "ì´ì¬ëª…": {
        "title": "ë‹¹ì‹ ì€ â€˜ì´ì¬ëª…â€™ê³¼ ê°€ì¥ ë¹„ìŠ·í•´ìš”!",
        "desc": "- ë³µì§€ í™•ëŒ€\n- ê¸°ë³¸ì†Œë“\n- ê³µê³µì£¼íƒÂ·í‰í™” ì™¸êµ",
        "emoji": "ğŸŒ±",
    },
    "ê¹€ë¬¸ìˆ˜": {
        "title": "ë‹¹ì‹ ì€ â€˜ê¹€ë¬¸ìˆ˜â€™ì™€ ê°€ì¥ ë¹„ìŠ·í•´ìš”!",
        "desc": "- ììœ ì‹œì¥Â·ì‘ì€ ì •ë¶€\n- ê°•ê²½ ì•ˆë³´\n- ì „í†µì  ê°€ì¹˜",
        "emoji": "ğŸ›¡ï¸",
    },
    "ì´ì¤€ì„": {
        "title": "ë‹¹ì‹ ì€ â€˜ì´ì¤€ì„â€™ê³¼ ê°€ì¥ ë¹„ìŠ·í•´ìš”!",
        "desc": "- ì²­ë…„Â·ê¸°ìˆ  ì¤‘ì‹¬\n- ì‹¤ìš©ì£¼ì˜\n- êµ¬ì¡° ê°œí˜",
        "emoji": "ğŸš€",
    },
}

# -----------------------------
# 2. ì„¸ì…˜ ì´ˆê¸°í™”
# -----------------------------
if "submitted" not in st.session_state:
    st.session_state.submitted = False
    st.session_state.answers = {}
    st.session_state.score = {}

# -----------------------------
# 3. í—¤ë” + ì•„ì´ì½˜
# -----------------------------
st.image(VOTE_ICON, width=80)
st.title("ğŸ—³ï¸ ëŒ€í†µë ¹ ì„±í–¥ í…ŒìŠ¤íŠ¸")
st.markdown("7ê°œì˜ ì§ˆë¬¸ì— ë‹µí•˜ë©´, **ë‹¹ì‹ ê³¼ ê°€ì¥ ì„±í–¥ì´ ë¹„ìŠ·í•œ ëŒ€í†µë ¹**ì„ ì°¾ì•„ë“œë¦½ë‹ˆë‹¤!")
st.markdown("---")

# -----------------------------
# 4. ì§ˆë¬¸ í¼
# -----------------------------
with st.form("quiz_form"):
    for idx, item in enumerate(QUESTIONS, start=1):
        st.markdown(f"### Q{idx}. {item['q']}")
        choice = st.radio(
            label="",
            options=[opt[0] for opt in item["opts"]],
            key=f"q{idx}",
            index=0,
        )
        st.session_state.answers[f"q{idx}"] = choice
    submitted = st.form_submit_button("ê²°ê³¼ ë³´ê¸°")

# -----------------------------
# 5. ê²°ê³¼ ê³„ì‚°
# -----------------------------
if submitted and not st.session_state.submitted:
    score = {"ì´ì¬ëª…": 0, "ê¹€ë¬¸ìˆ˜": 0, "ì´ì¤€ì„": 0}
    for idx, item in enumerate(QUESTIONS, start=1):
        sel_text = st.session_state.answers[f"q{idx}"]
        for opt_text, cand in item["opts"]:
            if sel_text == opt_text:
                score[cand] += 1
                break
    winner = max(score, key=score.get)
    st.session_state.submitted = True
    st.session_state.winner = winner
    st.session_state.score = score

# -----------------------------
# 6. ë‹¤ì‹œ ì‹œì‘ ì½œë°±
# -----------------------------
def reset_quiz():
    """ì„¸ì…˜ ë³€ìˆ˜ ì´ˆê¸°í™” í›„ í˜ì´ì§€ ë¦¬ë¡œë“œ"""
    for k in list(st.session_state.keys()):
        if k.startswith("q"):
            del st.session_state[k]
    st.session_state.submitted = False
    st.session_state.answers = {}
    st.session_state.score = {}
    st.rerun()

# -----------------------------
# 7. ê²°ê³¼ í˜ì´ì§€
# -----------------------------
if st.session_state.get("submitted"):
    result = RESULTS[st.session_state.winner]
    score = st.session_state.score

    st.markdown("---")
    # í›„ë³´ ì•„ì´ì½˜ + ì œëª©
    st.image(CAND_ICON[st.session_state.winner], width=120)
    st.header(f"{result['emoji']} {result['title']}")
    st.markdown(result["desc"])
    st.markdown(
        f"**ë“í‘œ(?) ê²°ê³¼**  \n"
        f"- ì´ì¬ëª…: {score['ì´ì¬ëª…']}  \n"
        f"- ê¹€ë¬¸ìˆ˜: {score['ê¹€ë¬¸ìˆ˜']}  \n"
        f"- ì´ì¤€ì„: {score['ì´ì¤€ì„']}"
    )
    st.button("ğŸ”„ ë‹¤ì‹œ í•´ë³´ê¸°", on_click=reset_quiz)
